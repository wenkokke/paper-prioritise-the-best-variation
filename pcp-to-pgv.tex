\documentclass[main.tex]{subfiles}

\begin{document}

\section{Priority CP to Priority GV}

\subsection{Translation}

\paragraph{Translation on types}
\[
\begin{array}{lcl}
  \ty{\cpgvT{\pcp{\tytens[\cs{o}]{A}{B}}}}
  & = & \pgv{\ty{\tysend[\cs{o}]{\co{\cpgvT{A}}}{\cpgvT{B}}}} \\
  \ty{\cpgvT{\pcp{\typarr[\cs{o}]{A}{B}}}}
  & = & \pgv{\ty{\tyrecv[\cs{o}]{\cpgvT{A}}{\cpgvT{B}}}} \\
  \ty{\cpgvT{\pcp{\typlus[\cs{o}]{A}{B}}}}
  & = & \pgv{\ty{\tyselect[\cs{o}]{\cpgvT{A}}{\cpgvT{B}}}} \\
  \ty{\cpgvT{\pcp{\tywith[\cs{o}]{A}{B}}}}
  & = & \pgv{\ty{\tyoffer[\cs{o}]{\cpgvT{A}}{\cpgvT{B}}}}
\end{array}
\quad
\begin{array}{lcl}
  \ty{\cpgvT{\pcp{\tyone[\cs{o}]}}}
  & = & \ty{\pgv{\tyends[\cs{o}]}} \\
  \ty{\cpgvT{\pcp{\tybot[\cs{o}]}}}
  & = & \ty{\pgv{\tyendr[\cs{o}]}} \\
  \ty{\cpgvT{\pcp{\tynil[\cs{o}]}}}
  & = & \pgv{\ty{\tyselectemp[\cs{o}]}} \\
  \ty{\cpgvT{\pcp{\tytop[\cs{o}]}}}
  & = & \pgv{\ty{\tyofferemp[\cs{o}]}}
\end{array}
\]

\paragraph{Translation on terms}
\[
\begin{array}{lcl}
  \pcp{\tm{\cpgvC{\res{x}{y}{P}}}}
  & = & \pgv{\tm{\res{x}{y}{\cpgvC{P}}}} \\
  \pcp{\tm{\cpgvC{\ppar{P}{Q}}}}
  & = & \pgv{\tm{\ppar{\cpgvC{P}}{\cpgvC{Q}}}} \\
  \pcp{\tm{\cpgvC{\send{x}{y}{P}}}}
  & = & \pgv{\tm{\res{y}{z}{(\child\;\letbind{x}{\send\;\pair{z}{x}}{\cpgvM{P}})}}} \\
  \pcp{\tm{\cpgvC{\inl{x}{P}}}}
  & = & \pgv{\tm{\res{y}{z}{(\child\;\letbind{x}{\andthen{\close\;(\send\;\pair{\inl{y}}{x})}{z}}{\cpgvM{P}})}}} \\
  \pcp{\tm{\cpgvC{\inr{x}{P}}}}
  & = & \pgv{\tm{\res{y}{z}{(\child\;\letbind{x}{\andthen{\close\;(\send\;\pair{\inr{y}}{x})}{z}}{\cpgvM{P}})}}} \\
  \pcp{\tm{\cpgvC{P}}}
  & = & \pgv{\tm{\child{\cpgvM{P}}}},\hfill\textit{if none of the above apply}\\
  \\
  \pcp{\tm{\cpgvM{\link{x}{y}}}}
  & = & \pgv{\tm{\link\;{\pair{x}{y}}}} \\
  \pcp{\tm{\cpgvM{\res{x}{y}{P}}}}
  & = & \pgv{\tm{\letpair{x}{y}{\new}{\cpgvM{P}}}} \\
  \pcp{\tm{\cpgvM{\ppar{P}{Q}}}}
  & = & \pgv{\tm{\andthen{\spawn\;{(\lambda\unit.\cpgvM{P})}}{\cpgvM{Q}}}} \\
  \pcp{\tm{\cpgvM{\halt}}}
  & = & \pgv{\tm{\unit}} \\
  \pcp{\tm{\cpgvM{\close{x}{P}}}}
  & = & \pgv{\tm{\andthen{\close\;{x}}{\cpgvM{P}}}} \\
  \pcp{\tm{\cpgvM{\wait{x}{P}}}}
  & = & \pgv{\tm{\andthen{\wait\;{x}}{\cpgvM{P}}}} \\
  \pcp{\tm{\cpgvM{\send{x}{y}{P}}}}
  & = & \pgv{\tm{\letpair{y}{z}{\new}{\letbind{x}{\send\;{\pair{z}{x}}}{\cpgvM{P}}}}} \\
  \pcp{\tm{\cpgvM{\recv{x}{y}{P}}}}
  & = & \pgv{\tm{\letpair{y}{x}{\recv\;{x}}{\cpgvM{P}}}} \\
  \pcp{\tm{\cpgvM{\inl{x}{P}}}}
  & = & \pgv{\tm{\letbind{x}{\select{\labinl}\;{x}}{\cpgvM{P}}}} \\
  \pcp{\tm{\cpgvM{\inr{x}{P}}}}
  & = & \pgv{\tm{\letbind{x}{\select{\labinr}\;{x}}{\cpgvM{P}}}} \\
  \multicolumn{3}{l}{\pcp{\tm{\cpgvM{\offer{x}{\cpgvM{P}}{\cpgvM{Q}}}}}} \\
  & = & \pgv{\tm{\offer{x}{x}{\cpgvM{P}}{x}{\cpgvM{Q}}}} \\
  \pcp{\tm{\cpgvM{\absurd{x}}}}
  & = & \pgv{\tm{\offeremp{x}}} \\
\end{array}
\]

\subsection{Metatheory}

\begin{restatablelemma}{lempcptopgvtermspreservation}[Preservation, $\cpgvM{\cdot}$]
  \label{lem:pcp-to-pgv-terms-preservation}
  \hfill\\%newline before theorem statement
  If $\pcp{\seq{P}{\ty{\Gamma}}}$ in PCP,
  then $\pgv{\tseq[\cs{p}]{\ty{\cpgvT{\Gamma}}}{\cpgvM{P}}{\tyunit}}$ in PGV.
\end{restatablelemma}
\begin{proof}
  By induction on the derivation of $\pcp{\seq{P}{\ty{\Gamma}}}$.
  (Details in \cref{prf:lem-pcp-to-pgv-terms-preservation}.)
\end{proof}

\begin{restatabletheorem}{thmpcptopgvconfspreservation}[Preservation, $\cpgvC{\cdot}$]
  \label{thm:pcp-to-pgv-confs-preservation}
  \hfill\\%newline before theorem statement
  If $\pcp{\seq{P}{\ty{\Gamma}}}$ in PCP,
  then $\pgv{\cseq[\child]{\ty{\cpgvT{\Gamma}}}{\cpgvC{P}}}$ in PGV.
\end{restatabletheorem}
\begin{proof}
  By induction on the derivation of $\pcp{\seq{P}{\ty{\Gamma}}}$.
  (Details in \cref{prf:lem-pcp-to-pgv-terms-preservation}.)
\end{proof}

\begin{restatabletheorem}{thmpcptopgvoperationalcorrespondencesoundness}%
  [Operational Correspondence, Soundness, $\cpgvC{\cdot}$]
  \label{thm:pcp-to-pgv-operational-correspondence-soundness}
  \hfill\\%newline before theorem statement
  If $\pcp{\seq{P}{\ty{\Gamma}}}$ and $\pgv{\tm{\cpgvC{P}}\cred\tm{\conf{C}}}$,
  there exists a $\tm{Q}$ such that $\pcp{\tm{P}\red\tm{Q}}$ and $\pgv{\tm{\conf{C}}\equiv\tm{\cpgvC{Q}}}$
\end{restatabletheorem}
\begin{proof}
  By induction on the derivation of $\pgv{\tm{\cpgvC{P}}\cred\tm{\conf{C}}}$.

  \todo{Finish proof.}

  \begin{case*}[\LabTirName{E-Link}]
    \begin{mathpar}
      \pgv{\tm{\res{x}{y}{(\ppar{\plug{\conf{F}}{\link\;\pair{w}{x}}}{\conf{C}})}}}
      \pgv{\cred}
      \pgv{\tm{\ppar{\plug{\conf{F}}{\unit}}{\subst{\conf{C}}{w}{y}}}}
    \end{mathpar}
    Translated from link.
  \end{case*}

  \begin{case*}[\LabTirName{E-Send}]
    \begin{mathpar}
      \pgv{\tm{\res{x}{y}{(\ppar{\plug{\conf{F}}{\send\;{\pair{V}{x}}}}{\plug{\conf{F'}}{\recv\;{y}}})}}}
      \pgv{\cred}
      \pgv{\tm{\res{x}{y}{(\ppar{\plug{\conf{F}}{x}}{\plug{\conf{F'}}{\pair{V}{y}}})}}}
    \end{mathpar}
    Translated from send/recv, or select/offer.
  \end{case*}

  \begin{case*}[\LabTirName{E-Close}]
    \begin{mathpar}
      \pgv{\tm{\res{x}{y}{(\ppar{\plug{\conf{F}}{\wait\;{x}}}{\plug{\conf{F'}}{\close\;{y}}})}}}
      \pgv{\cred}
      \pgv{\tm{\ppar{\plug{\conf{F}}{\unit}}{\plug{\conf{F'}}{\unit}}}}
    \end{mathpar}
    Translated from close/wait.
  \end{case*}

  \begin{case*}[\LabTirName{E-LiftC}]
  \end{case*}

  \begin{case*}[\LabTirName{E-LiftM}]
  \end{case*}

  \begin{case*}[\LabTirName{E-LiftSC}]
  \end{case*}
\end{proof}

\begin{restatablelemma}{lempcptopgvcpgvMcpgvCcompleteness}
  \label{lem:pcp-to-pgv-cpgvM-cpgvC-completeness}
  $\pgv{\tm{\child\;\cpgvM{P}}\cred^\star\tm{\cpgvC{P}}}$.
\end{restatablelemma}
\begin{proof}
  By induction on the structure of $\pcp{\tm{P}}$.
  (Details in \cref{prf:lem-pcp-to-pgv-cpgvM-cpgvC-completeness}.)
\end{proof}

\begin{restatablelemma}{lempcptopgvoperationalcorrespondenceequiv}%
  \label{lem:pcp-to-pgv-confs-operational-correspondence-equiv}
  If $\pcp{\seq{P}{\ty{\Gamma}}}$ and $\pcp{\tm{P}\equiv\tm{Q}}$,
  then $\pgv{\tm{\cpgvC{P}}\equiv\tm{\cpgvC{Q}}}$.
\end{restatablelemma}
\begin{proof}
  \label{prf:lem-pcp-to-pgv-confs-operational-correspondence-equiv}
  Every axiom of the structural congruence in PCP maps directly to the axiom of the same name in PGV.
\end{proof}

\begin{restatabletheorem}{thmpcptopgvoperationalcorrespondencecompleteness}%
  [Operational Correspondence, Completeness, $\cpgvC{\cdot}$]
  \label{thm:pcp-to-pgv-operational-correspondence-completeness}
  \hfill\\%newline before theorem statement
  If $\pcp{\seq{P}{\ty{\Gamma}}}$ and $\pcp{\tm{P}\red\tm{Q}}$,
  then $\pgv{\tm{\cpgvC{P}}\cred^+\tm{\cpgvC{Q}}}$.
\end{restatabletheorem}
\begin{proof}
  By induction on the derivation of $\pcp{\tm{P}\red\tm{Q}}$.
  We apply \cref{lem:pcp-to-pgv-cpgvM-cpgvC-completeness} for the cases in which
  the translation switches from $\tm{\cpgvC{\cdot}}$ to $\tm{\cpgvM{\cdot}}$,
  \ie under actions.
  We apply \cref{lem:pcp-to-pgv-confs-operational-correspondence-equiv} for
  \LabTirName{E-LiftSC}. 
  (Details in \cref{prf:thm-pcp-to-pgv-operational-correspondence-completeness}.)
\end{proof}

\end{document}

%%% Local Variables:
%%% TeX-master: "priorities"
%%% End:
